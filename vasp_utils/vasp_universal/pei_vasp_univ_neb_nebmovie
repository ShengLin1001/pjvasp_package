#!/bin/bash

main(){
    nebmovie
}

nebmovie(){
# ====================
# Configuration
# ====================
output_file="movie.xyz"

echo "-----------------------------------------------------------"
echo "Searching for numeric subdirectories containing POSCAR files"
echo "-----------------------------------------------------------"

# åˆ é™¤æ—§çš„è½¨è¿¹æ–‡ä»¶
rm -f "$output_file"
echo "==> nebmovie: read_vasp use ASE package and appending them in order"

python3 -c "
from ase.io import write
from ase.io.vasp import read_vasp
import os

# è·å–å½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„å­æ–‡ä»¶å¤¹åï¼Œå¹¶æ ¹æ®æ–‡ä»¶å¤¹åæ’åºï¼ˆæŒ‰æ•°å­—é¡ºåºï¼‰
folders = [folder for folder in os.listdir() if os.path.isdir(folder) and folder.isdigit()]

print(f'Found directory: {folders}')

# è¾“å‡ºè½¨è¿¹æ–‡ä»¶å
output_file = '$output_file'

# åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„è½¨è¿¹åˆ—è¡¨
atoms_list = []

# éå†æ¯ä¸ªæ–‡ä»¶å¤¹ï¼Œè¯»å–å…¶ä¸­çš„ POSCAR æ–‡ä»¶
for folder in sorted(folders, key=lambda x: int(x)):  # æŒ‰æ•°å­—é¡ºåºæ’åºæ–‡ä»¶å¤¹
    print(f'Appending: {folder}')
    poscar_file = os.path.join(folder, 'POSCAR')  # æ„å»º POSCAR æ–‡ä»¶çš„å®Œæ•´è·¯å¾„
    if os.path.exists(poscar_file):  # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        atoms = read_vasp(poscar_file)  # ä½¿ç”¨ ASE è¯»å– POSCAR æ–‡ä»¶
        atoms_list.append(atoms)

# å†™å…¥ LAMMPS è½¨è¿¹æ–‡ä»¶
write(output_file, atoms_list, format='extxyz')

print(f'Succesfully generated: {output_file}')
        "


echo "-----------------------------------------------------------"
echo "All structure data has been successfully extracted."
echo "Results have been saved to: $output_file"
echo "âœ… Slab structure extraction completed successfully."
echo "ğŸ“„ Output saved to: $output_file"
echo "-----------------------------------------------------------"
}


main "$@"; exit